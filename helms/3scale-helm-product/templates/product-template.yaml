{{- range $product := .Values.products }}
---
apiVersion: capabilities.3scale.net/v1beta1
kind: Product
metadata:
  name: {{ regexReplaceAll "_" (lower $product.name) "-" }}
spec:
  applicationPlans:
    plan_basic:
      limits:
        - metricMethodRef:
            systemName: hits
          period: day
          value: 30
      name: Basic
    plan_unlimited:
      name: Unlimited
  providerAccountRef:
    name: {{ $.Values.tenant_secret }}
    #namespace: 3scale
  name: {{ regexReplaceAll "-" $product.name "_" }}
  systemName: {{ regexReplaceAll "-" $product.name "_" }}
  description: {{ $product.description }}
  backendUsages:
    {{- toYaml $product.backendUsages | nindent 4 }}
  deployment:
    apicastSelfManaged:
      stagingPublicBaseURL: {{ $product.stagingPublicBaseURL }}
      productionPublicBaseURL: {{ $product.productionPublicBaseURL }}
      authentication:
        oidc:
            {{- toYaml $product.oidc | nindent 10 }}
{{- end }}
